{% extends "sindex.html" %}
{% block body %}
{% if obj1 %}

<!-- Google Maps API Script -->
<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?key=AIzaSyD3MPnSnyWwNmpnVEFkaddVvy_GWtxSejs&sensor=false"></script>
<script type="text/javascript">
    function myFunction() {
        var mapOptions = {
            center: new google.maps.LatLng(9.9763482, 76.286272),
            zoom: 14,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        var map = new google.maps.Map(document.getElementById("dvMap"), mapOptions);
        google.maps.event.addListener(map, 'click', function (e) {
            alert("Latitude: " + e.latLng.lat() + "\r\nLongitude: " + e.latLng.lng());
            document.getElementById('slati').value = e.latLng.lat();
            document.getElementById('elongi').value = e.latLng.lng();
        });
    }
</script>

<!-- Form for Updating Facility -->
<form action="" method="post" enctype="multipart/form-data">
    <div class="form-container">
        <h2>Update Facility</h2>
        <table>
            <tr>
                <th>Type</th>
                <td><input type="text" name="type" value="{{obj1.type}}" id=""></td>
            </tr>
            <tr>
                <th>Facility Name</th>
                <td><input type="text" name="name" value="{{obj1.f_name}}" id=""></td>
            </tr>
            <tr>
                <th>Place</th>
                <td><input type="text" name="place" value="{{obj1.f_place}}" id=""></td>
            </tr>
            <tr>
                <th>Latitude</th>
                <td><input type="text" name="lati" value="{{obj1.lati}}" id="slati" class="form-control"></td>
                <td><button type="button" onclick="myFunction()">View Map</button></td>
            </tr>
            <tr>
                <th>Longitude</th>
                <td><input type="text" name="longi" value="{{obj1.longi}}" id="elongi" class="form-control" required></td>
            </tr>
            <tr>
                <th>City</th>
                <td><input type="text" name="city" value="{{obj1.city}}" id=""></td>
            </tr>
            <tr>
                <th>State</th>
                <td><input type="text" name="state" value="{{obj1.state}}" id=""></td>
            </tr>
            <tr>
                <th>Contact</th>
                <td><input type="number" name="phone" value="{{obj1.phone}}" pattern="[0-9]{10}" maxlength="10" id="" required></td>
            </tr>
            <tr>
                <th>Email</th>
                <td><input type="email" name="email" value="{{obj1.email}}" id=""></td>
            </tr>
            <tr>
                <th>Photo</th>
                <td><input type="file" name="img1" id="imgInput" onchange="previewImage()" required></td>
            </tr>
            <tr>
                <td colspan="2"><input type="submit" value="Update Facility" name="update" id="submitBtn"></td>
            </tr>
        </table>
    </div>
    <div class="map-container">
        <div id="dvMap"></div>
    </div>
</form>

<script>
    function previewImage() {
        var input = document.getElementById('imgInput');
        var preview = document.getElementById('imgPreview');
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            reader.onload = function (e) {
                preview.src = e.target.result;
            };
            reader.readAsDataURL(input.files[0]);
        }
    }
</script>

{% else %}

<!-- Google Maps API Script -->
<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?key=AIzaSyD3MPnSnyWwNmpnVEFkaddVvy_GWtxSejs&sensor=false"></script>
<script type="text/javascript">
    function myFunction() {
        var mapOptions = {
            center: new google.maps.LatLng(9.9763482, 76.286272),
            zoom: 14,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        var map = new google.maps.Map(document.getElementById("dvMap"), mapOptions);
        google.maps.event.addListener(map, 'click', function (e) {
            alert("Latitude: " + e.latLng.lat() + "\r\nLongitude: " + e.latLng.lng());
            document.getElementById('slati').value = e.latLng.lat();
            document.getElementById('elongi').value = e.latLng.lng();
        });
    }
</script>

<!-- Form for Adding Facility -->
<center>
    <h1>Manage Facility</h1>
</center>
<div class="form-container">
    <form action="" method="post" enctype="multipart/form-data">
        <table>
            <tr>
                <th>Type</th>
                <td><input type="text" name="type" id=""></td>
            </tr>
            <tr>
                <th>Facility Name</th>
                <td><input type="text" name="name" id=""></td>
            </tr>
            <tr>
                <th>Place</th>
                <td><input type="text" name="place" id=""></td>
            </tr>
            <tr>
                <th>Latitude</th>
                <td><input type="text" name="lati" id="slati" class="form-control"></td>
                <td><button type="button" onclick="myFunction()">View Map</button></td>
            </tr>
            <tr>
                <th>Longitude</th>
                <td><input type="text" name="longi" id="elongi" class="form-control" required></td>
            </tr>
            <tr>
                <th>City</th>
                <td><input type="text" name="city" id=""></td>
            </tr>
            <tr>
                <th>State</th>
                <td><input type="text" name="state" id=""></td>
            </tr>
            <tr>
                <th>Contact</th>
                <td><input type="number" name="phone" pattern="[0-9]{10}" maxlength="10" title="Enter a valid phone number" id=""></td>
            </tr>
            <tr>
                <th>Email</th>
                <td><input type="email" name="email" id=""></td>
            </tr>
            <tr>
                <th>Photo</th>
                <td><input type="file" name="img1" id=""></td>
            </tr>
            <tr>
                <td colspan="2"><input type="submit" value="Register Facility" name="submit" id="submitBtn"></td>
            </tr>
        </table>
    </form>
</div>
<div class="map-container">
    <div id="dvMap"></div>
</div>

<!-- Table of Facilities -->
<table class="facility-table" align="center" border="1">
    <thead>
        <tr>
            <th>Type</th>
            <th>Facility</th>
            <th>Place</th>
            <th>Latitude</th>
            <th>Longitude</th>
            <th>City</th>
            <th>State</th>
            <th>Phone</th>
            <th>Email</th>
            <th>Gallery</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for i in obj %}
        <tr>
            <td>{{i.type}}</td>
            <td>{{i.f_name}}</td>
            <td>{{i.f_place}}</td>
            <td>{{i.lati}}</td>
            <td>{{i.longi}}</td>
            <td>{{i.city}}</td>
            <td>{{i.state}}</td>
            <td>{{i.phone}}</td>
            <td>{{i.email}}</td>
            <td><img src="static/{{i.photo}}" height="100px" width="100px"></td>
            <td><a href="/admin_update_facility/{{i.facility_id}}">Update</a> |
                <a href="/admin_delete_facility/{{i.facility_id}}">Delete</a></td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% endif %}

<!-- CSS Styles for Improving Design -->
<style>
    .form-container {
        width: 50%;
        margin: 0 auto;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 8px;
        background-color: #f9f9f9;
    }

    .form-container h2 {
        text-align: center;
        margin-bottom: 20px;
        font-size: 24px;
    }

    .form-container table {
        width: 100%;
        margin: 0 auto;
        padding: 10px;
    }

    .form-container th, .form-container td {
        padding: 10px;
        text-align: left;
    }

    .form-container input[type="text"], .form-container input[type="email"], .form-container input[type="number"], .form-container input[type="file"] {
        width: 100%;
        padding: 8px;
        border-radius: 4px;
        border: 1px solid #ccc;
    }

    .form-container input[type="submit"] {
        padding: 10px 15px;
        background-color: #4CAF50;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

    .form-container input[type="submit"]:hover {
        background-color: #45a049;
    }

    .map-container {
        width: 100%;
        text-align: center;
        margin-top: 20px;
    }

    #dvMap {
        width: 300px;
        height: 300px;
        border: 1px solid #ccc;
        border-radius: 8px;
    }

    .facility-table {
        width: 90%;
        margin: 30px auto;
        border-collapse: collapse;
    }

    .facility-table th, .facility-table td {
        padding: 12px;
        text-align: center;
    }

    .facility-table th {
        background-color: #f2f2f2;
    }

    .facility-table td img {
        border-radius: 4px;
    }

    .facility-table a {
        text-decoration: none;
        color: #007BFF;
        margin-right: 10px;
    }

    .facility-table a:hover {
        text-decoration: underline;
    }
</style>

{% endblock %}
